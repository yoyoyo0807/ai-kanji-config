<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›ç­”ã®ç¢ºèª - {{ title }}</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f5f7; padding: 15px; text-align: center; color: #333; }
        .card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 450px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; }
        .time-btn { border: 2px solid #ddd; padding: 10px 5px; border-radius: 12px; cursor: pointer; background: white; font-size: 0.85rem; display: flex; flex-direction: column; justify-content: center; min-height: 65px; transition: 0.2s; }
        
        /* OKï¼ˆç©ºã„ã¦ã„ã‚‹ï¼‰ã®çŠ¶æ…‹ï¼šLINEã‚«ãƒ©ãƒ¼ */
        .time-btn.selected { border-color: #00b900; background: #eaffea; color: #00b900; font-weight: bold; }
        /* NGï¼ˆäºˆå®šã‚ã‚Šï¼‰ã®çŠ¶æ…‹ï¼šå°‘ã—è–„ãã—ã¦ã€ŒåŸ‹ã¾ã£ã¦ã„ã‚‹æ„Ÿã€ã‚’å‡ºã™ */
        .time-btn.busy { border-color: #ffcdd2; background: #ffebee; color: #ef5350; }
        
        .submit-btn { width: 100%; padding: 18px; background: #00b900; color: white; border: none; border-radius: 35px; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: 10px; }
        
        .privacy-msg { font-size: 0.75rem; color: #666; margin-top: 15px; padding: 12px; background: #fffde7; border-radius: 10px; text-align: left; border: 1px solid #ffe082; line-height: 1.4; }
        
        /* å¯©æŸ»ç”¨ãƒªãƒ³ã‚¯ */
        .footer-links { margin-top: 25px; font-size: 0.7rem; color: #999; }
        .footer-links a { color: #999; text-decoration: none; margin: 0 8px; }
    </style>
</head>
<body>
    <div class="card">
        <h2 style="color:#00b900; margin-top:0;">{{ title }}</h2>
        <p style="font-size:0.9rem; color:#666;">Googleé€£æºã«ã‚ˆã‚Šç©ºãæ™‚é–“ã‚’è‡ªå‹•é¸æŠã—ã¾ã—ãŸã€‚<br>ä¸éƒ½åˆãŒã‚ã‚Œã°èª¿æ•´ã—ã¦ãã ã•ã„ã€‚</p>

        <div class="grid" id="slotGrid"></div>

        <button class="submit-btn" onclick="sendResponse()">å›ç­”ã‚’ç¢ºå®šã™ã‚‹</button>
        
        <div class="privacy-msg">
            ğŸ›¡ï¸ <b>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã«ã¤ã„ã¦</b><br>
            ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®å…·ä½“çš„ãªäºˆå®šã®å†…å®¹ï¼ˆå ´æ‰€ã‚„ã‚¿ã‚¤ãƒˆãƒ«ï¼‰ã¯ã€å¹¹äº‹ã‚’å«ã‚èª°ã«ã‚‚é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚ã€Œç©ºã/äºˆå®šã‚ã‚Šã€ã¨ã„ã†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ã¿ãŒå…±æœ‰ã•ã‚Œã¾ã™ã€‚
        </div>
    </div>

    <div class="footer-links">
        <a href="/privacy-policy">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
        <a href="/terms">åˆ©ç”¨è¦ç´„</a>
    </div>

    <script>
        const busySlots = {{ busy_slots | tojson }};
        
        // æœ¬æ¥ã¯URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç­‰ã‹ã‚‰å–å¾—ã—ã¾ã™ãŒã€ã¾ãšã¯ç›´è¿‘3æ—¥é–“ã§è¡¨ç¤ºä¾‹ã‚’ä½œæˆ
        const today = new Date();
        const dates = [];
        for(let i=0; i<3; i++) {
            const d = new Date();
            d.setDate(today.getDate() + i);
            dates.push(d.toISOString().split('T')[0]);
        }
        const times = ["12:00", "18:00", "20:00"];

        const grid = document.getElementById('slotGrid');

        dates.forEach(date => {
            times.forEach(time => {
                const btn = document.createElement('button');
                btn.className = 'time-btn';
                
                const slotKey = `${date}_${time}`;
                const dObj = new Date(date);
                const dateLabel = `${dObj.getMonth() + 1}/${dObj.getDate()}`;
                const dayLabel = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][dObj.getDay()];

                btn.innerHTML = `<span style="font-size:0.7rem;">${dateLabel}(${dayLabel})</span><b>${time}</b>`;

                // è‡ªå‹•åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
                if (busySlots.includes(slotKey) || busySlots.includes(date + "_ALLDAY")) {
                    btn.classList.add('busy'); 
                    btn.dataset.status = "ng";
                } else {
                    btn.classList.add('selected');
                    btn.dataset.status = "ok";
                }

                btn.onclick = () => {
                    if (btn.dataset.status === "ok") {
                        btn.classList.remove('selected');
                        btn.classList.add('busy');
                        btn.dataset.status = "ng";
                    } else {
                        btn.classList.remove('busy');
                        btn.classList.add('selected');
                        btn.dataset.status = "ok";
                    }
                };
                grid.appendChild(btn);
            });
        });

        function sendResponse() {
            alert("å›ç­”ãŒå®Œäº†ã—ã¾ã—ãŸï¼AIãŒé›†è¨ˆã‚’è¡Œã„ã¾ã™ã€‚");
            window.close();
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›ç­”ã®ç¢ºèª - {{ title }}</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f5f7; padding: 15px; text-align: center; color: #333; }
        .card { background: white; border-radius: 24px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); max-width: 450px; margin: auto; }
        
        /* ğŸ’¡ å–å¾—ã—ãŸäºˆå®šã‚’è¦‹ã›ã‚‹ã‚¨ãƒªã‚¢ï¼ˆæ—§ãƒ‡ã‚¶ã‚¤ãƒ³ã®è‰¯ã„ã¨ã“ã‚ï¼‰ */
        .info-section { background: #f8f9fa; border-radius: 16px; padding: 15px; margin-bottom: 20px; text-align: left; border: 1px solid #eee; }
        .info-tag { display: inline-block; background: #e9ecef; color: #495057; font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; margin-bottom: 8px; font-weight: bold; }
        .busy-list { font-size: 0.85rem; color: #666; margin: 0; padding: 0; list-style: none; }
        .busy-list li { padding: 4px 0; display: flex; align-items: center; }
        .busy-list li::before { content: "ğŸ“…"; margin-right: 8px; font-size: 0.8rem; }

        /* ã‚°ãƒªãƒƒãƒ‰UIï¼ˆç¾è¡Œãƒ‡ã‚¶ã‚¤ãƒ³ã®è‰¯ã„ã¨ã“ã‚ï¼‰ */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; }
        .time-btn { border: 2px solid #ddd; padding: 12px 5px; border-radius: 12px; cursor: pointer; background: white; font-size: 0.85rem; display: flex; flex-direction: column; justify-content: center; min-height: 65px; transition: 0.2s; }
        .time-btn.selected { border-color: #00b900; background: #eaffea; color: #00b900; font-weight: bold; }
        .time-btn.busy { border-color: #ffcdd2; background: #ffebee; color: #ef5350; }
        
        .submit-btn { width: 100%; padding: 18px; background: #00b900; color: white; border: none; border-radius: 35px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        .privacy-msg { font-size: 0.75rem; color: #666; margin-top: 15px; padding: 12px; background: #fffde7; border-radius: 10px; text-align: left; border: 1px solid #ffe082; }
        .footer-links { margin-top: 25px; font-size: 0.7rem; color: #bbb; }
    </style>
</head>
<body>
    <div class="card">
        <h2 style="color:#00b900; margin-top:0;">ğŸ“… äºˆå®šã‚’ç¢ºèªã—ã¾ã—ãŸ</h2>
        
        <div class="info-section">
            <span class="info-tag">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ã®å–å¾—çµæœ</span>
            <ul class="busy-list" id="busyDetailList">
                </ul>
        </div>

        <p style="font-size:0.85rem; color:#666;">é‡è¤‡ã™ã‚‹æ ã‚’è‡ªå‹•ã§NGã«ã—ã¾ã—ãŸã€‚<br>ã‚¿ãƒƒãƒ—ã§èª¿æ•´ã‚‚å¯èƒ½ã§ã™ã€‚</p>

        <div class="grid" id="slotGrid"></div>

        <button class="submit-btn" onclick="sendResponse()">å›ç­”ã‚’ç¢ºå®šã™ã‚‹</button>
        
        <div class="privacy-msg">
            ğŸ›¡ï¸ <b>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·</b><br>
            å…·ä½“çš„ãªäºˆå®šåï¼ˆä¾‹ï¼šä¼šè­°ï¼‰ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚ç©ºãçŠ¶æ³ã®ã¿ãŒå…±æœ‰ã•ã‚Œã¾ã™ã€‚
        </div>
    </div>

    <div class="footer-links">
        <a href="/privacy-policy" style="color:#bbb; text-decoration:none;">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a> | 
        <a href="/terms" style="color:#bbb; text-decoration:none;">åˆ©ç”¨è¦ç´„</a>
    </div>

    <script>
        const busySlots = {{ busy_slots | tojson }};
        const busyDetailList = document.getElementById('busyDetailList');
        
        // äºˆå®šã‚ã‚Šã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºï¼ˆç´å¾—æ„Ÿã‚’é«˜ã‚ã‚‹ï¼‰
        if (busySlots.length > 0) {
            busySlots.forEach(slot => {
                const li = document.createElement('li');
                // "2025-12-30_20:00" -> "12/30 20:00" ã«å¤‰æ›
                const cleanText = slot.replace('-', '/').replace('_', ' ').substring(5);
                li.innerText = `${cleanText}: äºˆå®šã‚ã‚Š`;
                busyDetailList.appendChild(li);
            });
        } else {
            busyDetailList.innerHTML = "<li>é‡è¤‡ã™ã‚‹äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ</li>";
        }

        const dates = ["2025-12-30", "2025-12-31", "2026-01-01"];
        const times = ["12:00", "18:00", "20:00"];
        const grid = document.getElementById('slotGrid');

        dates.forEach(date => {
            times.forEach(time => {
                const btn = document.createElement('button');
                btn.className = 'time-btn';
                const slotKey = `${date}_${time}`;
                const displayDate = date.split('-').slice(1).join('/');

                btn.innerHTML = `<span style="font-size:0.7rem;">${displayDate}</span><b>${time}</b>`;

                if (busySlots.includes(slotKey)) {
                    btn.classList.add('busy');
                    btn.dataset.status = "ng";
                } else {
                    btn.classList.add('selected');
                    btn.dataset.status = "ok";
                }

                btn.onclick = () => {
                    if (btn.dataset.status === "ok") {
                        btn.classList.remove('selected');
                        btn.classList.add('busy');
                        btn.dataset.status = "ng";
                    } else {
                        btn.classList.remove('busy');
                        btn.classList.add('selected');
                        btn.dataset.status = "ok";
                    }
                };
                grid.appendChild(btn);
            });
        });

        function sendResponse() {
            alert("å›ç­”ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ãƒˆãƒ¼ã‚¯ç”»é¢ã«æˆ»ã£ã¦ãã ã•ã„ã€‚");
            window.close();
        }
    </script>
</body>
</html>

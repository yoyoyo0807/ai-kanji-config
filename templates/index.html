<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜åº¦ãªæ—¥ç¨‹èª¿æ•´ãƒ„ãƒ¼ãƒ«</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f5f7; margin: 0; padding: 15px; padding-bottom: 100px; }
        .container { max-width: 500px; margin: auto; background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .section-title { font-size: 0.95rem; font-weight: bold; border-left: 4px solid #00b900; padding-left: 10px; margin: 25px 0 10px; }
        .tab-container { display: flex; border-bottom: 2px solid #eee; margin-bottom: 10px; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; color: #888; }
        .tab.active { color: #00b900; border-bottom: 2px solid #00b900; font-weight: bold; }
        .list-box { border: 1px solid #eee; border-radius: 12px; max-height: 180px; overflow-y: auto; background: #fafafa; margin-bottom: 15px; }
        .list-item { display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }
        .selected-area { background: #eef9ee; border: 2px solid #00b900; border-radius: 12px; padding: 12px; margin-bottom: 20px; }
        .selected-member { display: flex; align-items: center; justify-content: space-between; background: white; padding: 8px 12px; border-radius: 8px; margin-bottom: 5px; font-size: 0.85rem; }
        .prio-btn { background: #ddd; border: none; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; cursor: pointer; }
        .prio-btn.active { background: #ffcf00; font-weight: bold; }
        .time-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .time-item { background: #f9f9f9; padding: 8px; border-radius: 8px; border: 1px solid #eee; font-size: 0.8rem; }
        button#submit-btn { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 450px; background: #00b900; color: white; border: none; padding: 16px; border-radius: 30px; font-weight: bold; font-size: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“… æ—¥ç¨‹èª¿æ•´ã‚’ä½œæˆ</h1>
        <div class="section-title">1. é–‹å‚¬æœŸé–“ã‚’é¸æŠ</div>
        <input type="date" id="start"> ã€œ <input type="date" id="end">

        <div class="section-title">2. å‚åŠ ãƒ¡ãƒ³ãƒãƒ¼ã‚’é¸æŠ</div>
        <div class="tab-container">
            <div class="tab active" id="t-f" onclick="show('f')">å‹ã ã¡</div>
            <div class="tab" id="t-g" onclick="show('g')">ã‚°ãƒ«ãƒ¼ãƒ—</div>
        </div>
        <div class="list-box" id="f-list"></div>
        <div class="list-box" id="g-list" style="display:none;"></div>

        <div class="section-title">3. å„ªå…ˆãƒ¡ãƒ³ãƒãƒ¼ï¼ˆâ˜…ã‚’ã‚¿ãƒƒãƒ—ï¼‰</div>
        <div class="selected-area" id="selected-list"><p style="font-size:0.75rem; text-align:center;">ãƒ¡ãƒ³ãƒãƒ¼æœªé¸æŠ</p></div>

        <div class="section-title">4. å¸Œæœ›ã™ã‚‹æ™‚é–“å¸¯</div>
        <div class="time-grid" id="time-grid"></div>

        <button id="submit-btn" onclick="requestCalculation()">æœ€é©ãªæ—¥ç¨‹ã‚’ç®—å‡ºã™ã‚‹</button>
    </div>

    <script>
        const LIFF_ID = "2008718467-wSHMbZKY"; // ç™ºè¡Œã•ã‚ŒãŸID
        const members = Array.from({length: 20}, (_, i) => `ãƒ¡ãƒ³ãƒãƒ¼${i+1}`);
        const groups = { 'ã‚°ãƒ«ãƒ¼ãƒ—A': ['ãƒªãƒ¼ãƒ€ãƒ¼A', 'ä¼šå“¡A1', 'ä¼šå“¡A2'], 'ã‚°ãƒ«ãƒ¼ãƒ—B': ['ãƒªãƒ¼ãƒ€ãƒ¼B', 'ä¼šå“¡B1', 'ä¼šå“¡B2'] };
        let selected = new Set();
        let priorities = new Set();

        // LIFFåˆæœŸåŒ–
        liff.init({ liffId: LIFF_ID }).then(() => {
            if (!liff.isLoggedIn()) liff.login();
        }).catch(err => console.error(err));

        function show(t) {
            document.getElementById('t-f').classList.toggle('active', t==='f');
            document.getElementById('t-g').classList.toggle('active', t==='g');
            document.getElementById('f-list').style.display = t==='f' ? 'block' : 'none';
            document.getElementById('g-list').style.display = t==='g' ? 'block' : 'none';
        }

        function renderLists() {
            document.getElementById('f-list').innerHTML = members.map(m => `<div class="list-item"><span>${m}</span><input type="checkbox" onchange="toggleM('${m}', this.checked)"></div>`).join('');
            document.getElementById('g-list').innerHTML = Object.keys(groups).map(g => `<div class="list-item"><strong>${g}</strong><input type="checkbox" onchange="toggleG('${g}', this.checked)"></div>`).join('');
        }

        function toggleM(m, isAdd) {
            if(isAdd) selected.add(m); else { selected.delete(m); priorities.delete(m); }
            updateV();
        }

        function toggleG(g, isAdd) {
            groups[g].forEach(m => isAdd ? selected.add(m) : (selected.delete(m), priorities.delete(m)));
            updateV();
        }

        function updateV() {
            const area = document.getElementById('selected-list');
            if(selected.size === 0) { area.innerHTML = '<p style="text-align:center; font-size:0.8rem;">ãƒ¡ãƒ³ãƒãƒ¼æœªé¸æŠ</p>'; return; }
            area.innerHTML = Array.from(selected).map(m => `<div class="selected-member"><span>${m}</span><button class="prio-btn ${priorities.has(m)?'active':''}" onclick="toggleP('${m}')">${priorities.has(m)?'â˜… å„ªå…ˆä¸­':'â˜… å„ªå…ˆã«ã™ã‚‹'}</button></div>`).join('');
        }

        function toggleP(m) {
            if(priorities.has(m)) priorities.delete(m); else priorities.add(m);
            updateV();
        }

        const grid = document.getElementById('time-grid');
        for(let h=6; h<24; h+=2) grid.innerHTML += `<div class="time-item"><input type="checkbox" name="t-check" value="${h}:00"> ${h}:00ã€œ${h+2}:00</div>`;

        function requestCalculation() {
            const start = document.getElementById('start').value;
            const end = document.getElementById('end').value;
            const tChecked = Array.from(document.querySelectorAll('input[name="t-check"]:checked')).map(e => e.value);
            
            if(!start || selected.size === 0) { alert("æœŸé–“ã¨ãƒ¡ãƒ³ãƒãƒ¼ã‚’é¸ã‚“ã§ãã ã•ã„"); return; }

            const msg = `èª¿æ•´é–‹å§‹\næœŸé–“ï¼š${start}ã€œ${end}\nå‚åŠ ï¼š${Array.from(selected).join(',')}\nå„ªå…ˆï¼š${Array.from(priorities).join(',')}\næ™‚é–“ï¼š${tChecked.join(',')}`;

            liff.sendMessages([{ type: 'text', text: msg }])
                .then(() => liff.closeWindow())
                .catch(err => alert("é€ä¿¡å¤±æ•—: " + err));
        }
        renderLists();
    </script>
</body>
</html>

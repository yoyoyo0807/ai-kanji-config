<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå¹¹äº‹ãã‚“ - æ—¥ç¨‹èª¿æ•´</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f5f7; margin: 0; padding: 15px; padding-bottom: 100px; }
        .container { max-width: 500px; margin: auto; background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .section-title { font-size: 0.95rem; font-weight: bold; border-left: 4px solid #00b900; padding-left: 10px; margin: 25px 0 10px; }
        input[type="date"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin: 5px 0; box-sizing: border-box; font-size: 1rem; }
        .btn-submit { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 450px; background: #00b900; color: white; border: none; padding: 16px; border-radius: 30px; font-weight: bold; font-size: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; transition: opacity 0.3s; }
        .btn-submit:disabled { background: #ccc; cursor: not-allowed; }
        .note { font-size: 0.8rem; color: #666; margin-top: 10px; line-height: 1.4; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“… æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ</h1>
        
        <div class="section-title">1. é–‹å‚¬æœŸé–“ã‚’é¸æŠ</div>
        <input type="date" id="start"> ã€œ <input type="date" id="end">
        <p class="note">â€»AIãŒã“ã®æœŸé–“å†…ã®å…¨å“¡ã®ç©ºãæ™‚é–“ã‚’è‡ªå‹•ç®—å‡ºã—ã¾ã™ã€‚</p>

        <div class="section-title">2. æ‹›å¾…ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡</div>
        <p class="note">ã€Œãƒ¡ãƒ³ãƒãƒ¼ã‚’é¸ã‚“ã§æ‹›å¾…ã‚’é€ã‚‹ã€ã‚’æŠ¼ã™ã¨ã€LINEã®å‹ã ã¡é¸æŠç”»é¢ãŒé–‹ãã¾ã™ã€‚<br>å›ç­”æœŸé™ã¯é€ä¿¡ã‹ã‚‰<b>12æ™‚é–“</b>ã§ã™ã€‚</p>

        <button class="btn-submit" id="main-btn" onclick="sendInvitation()" disabled>èª­ã¿è¾¼ã¿ä¸­...</button>
    </div>

    <script>
        const LIFF_ID = "2008718467-wSHMbZKY";
        let myProfile = null;

        // LIFFã®åˆæœŸåŒ–
        liff.init({ liffId: LIFF_ID }).then(async () => {
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                myProfile = await liff.getProfile();
                const btn = document.getElementById('main-btn');
                btn.disabled = false;
                btn.innerText = "ãƒ¡ãƒ³ãƒãƒ¼ã‚’é¸ã‚“ã§æ‹›å¾…ã‚’é€ã‚‹";
            }
        }).catch(err => {
            alert("LIFFåˆæœŸåŒ–å¤±æ•—: " + err.message);
        });

        async function sendInvitation() {
            const start = document.getElementById('start').value;
            const end = document.getElementById('end').value;
            
            if(!start || !end) {
                alert("é–‹å‚¬æœŸé–“ã‚’é¸æŠã—ã¦ãã ã•ã„");
                return;
            }

            // æ¨©é™ç¢ºèª
            if (!liff.isApiAvailable('shareTargetPicker')) {
                alert("ã‚·ã‚§ã‚¢ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ”ãƒƒã‚«ãƒ¼ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ç®¡ç†ç”»é¢ã§ã€shareTargetPickerã€ã«ãƒã‚§ãƒƒã‚¯ãŒå…¥ã£ã¦ã„ã‚‹ã‹ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            liff.shareTargetPicker([
                {
                    "type": "flex",
                    "altText": "æ—¥ç¨‹èª¿æ•´ã®æ‹›å¾…çŠ¶ãŒå±Šãã¾ã—ãŸ",
                    "contents": {
                        "type": "bubble",
                        "body": {
                            "type": "box", "layout": "vertical",
                            "contents": [
                                {"type": "text", "text": "ğŸ“… æ—¥ç¨‹èª¿æ•´ã®æ‹›å¾…", "weight": "bold", "size": "xl", "color": "#00b900"},
                                {"type": "text", "text": `${myProfile.displayName}ã•ã‚“ã‹ã‚‰ãŠèª˜ã„ã§ã™ï¼`, "size": "sm", "margin": "md", "wrap": true},
                                {"type": "separator", "margin": "lg"},
                                {"type": "box", "layout": "vertical", "margin": "lg", "contents": [
                                    {"type": "text", "text": "å¸Œæœ›æœŸé–“", "size": "xs", "color": "#888888"},
                                    {"type": "text", "text": `${start} ã€œ ${end}`, "size": "md", "weight": "bold"}
                                ]},
                                {"type": "text", "text": "âš ï¸ å›ç­”æœŸé™: 12æ™‚é–“ä»¥å†…", "size": "xs", "color": "#ff0000", "margin": "md", "weight": "bold"}
                            ]
                        },
                        "footer": {
                            "type": "box", "layout": "vertical", "spacing": "sm",
                            "contents": [
                                {
                                    "type": "button", "style": "primary", "color": "#00b900",
                                    "action": { 
                                        "type": "uri", 
                                        "label": "âœ… å‚åŠ ã™ã‚‹", 
                                        "uri": `https://liff.line.me/${LIFF_ID}/answer?res=yes&host=${encodeURIComponent(myProfile.displayName)}` 
                                    }
                                },
                                {
                                    "type": "button", "style": "secondary",
                                    "action": { 
                                        "type": "uri", 
                                        "label": "âŒ è¡Œã‘ãªã„", 
                                        "uri": `https://liff.line.me/${LIFF_ID}/answer?res=no` 
                                    }
                                }
                            ]
                        }
                    }
                }
            ]).then((res) => {
                if (res) liff.closeWindow(); // é€ä¿¡æˆåŠŸã—ãŸã‚‰é–‰ã˜ã‚‹
            }).catch(err => {
                alert("é€ä¿¡ã‚¨ãƒ©ãƒ¼: " + err.message);
            });
        }
    </script>
</body>
</html>
